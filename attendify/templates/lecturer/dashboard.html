{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lecturer Dashboard - Attendify</title>
    
    <!-- External CSS -->
    <link rel="stylesheet" href="{% static 'css/lecturer.css' %}">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
</head>
<body>
    <!-- Matrix Background Canvas -->
    <canvas id="matrixCanvas"></canvas>
    
    <!-- Cyber Grid Overlay -->
    <div class="cyber-grid"></div>
    
    <!-- Navigation Header -->
    <header class="dashboard-header">
        <div class="header-container">
            <div class="brand-section">
                <div class="logo">
                    <div class="cyber-logo">
                        <i class="fas fa-chalkboard-teacher"></i>
                        <div class="glow-effect"></div>
                    </div>
                    <span class="brand-name">ATTENDIFY</span>
                </div>
                <h1 class="dashboard-title">LECTURER DASHBOARD</h1>
            </div>
            
            <div class="user-section">
                <div class="user-info">
                    <div class="user-avatar">
                        {% if user.lecturer_profile.profile_picture %}
                            <img src="{{ user.lecturer_profile.profile_picture.url }}" alt="Profile">
                        {% else %}
                            <i class="fas fa-user-circle"></i>
                        {% endif %}
                        <div class="avatar-glow"></div>
                    </div>
                    <div class="user-details">
                        <span class="user-name">{{ user.get_full_name|default:user.username }}</span>
                        <span class="user-role">LECTURER</span>
                    </div>
                </div>
                <div class="header-actions">
                    <button class="btn-notification" id="notificationBtn">
                        <i class="fas fa-bell"></i>
                        <span class="notification-badge">3</span>
                        <div class="btn-glow"></div>
                    </button>
                    <div class="dropdown">
                        <button class="btn-profile-dropdown">
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <div class="dropdown-menu cyber-dropdown">
                            <a href="{% url 'profile_edit' %}" class="dropdown-item">
                                <i class="fas fa-user-edit"></i>EDIT PROFILE
                            </a>
                            <a href="{% url 'change_password' %}" class="dropdown-item">
                                <i class="fas fa-key"></i>CHANGE PASSWORD
                            </a>
                            <div class="dropdown-divider"></div>
                            <a href="{% url 'logout' %}" class="dropdown-item logout">
                                <i class="fas fa-sign-out-alt"></i>LOGOUT
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Dashboard Layout -->
    <div class="dashboard-container">
        <!-- Sidebar Navigation -->
        <aside class="sidebar">
            <nav class="sidebar-nav">
                <a href="{% url 'lecturer_dashboard' %}" class="nav-item active">
                    <div class="nav-icon">
                        <i class="fas fa-tachometer-alt"></i>
                        <div class="nav-glow"></div>
                    </div>
                    <span>DASHBOARD</span>
                    <div class="nav-indicator"></div>
                </a>
                <a href="{% url 'lecturer_portal' %}" class="nav-item">
                    <div class="nav-icon">
                        <i class="fas fa-book-open"></i>
                        <div class="nav-glow"></div>
                    </div>
                    <span>TEACHING PORTAL</span>
                    <div class="nav-indicator"></div>
                </a>
                <a href="{% url 'lecturer_attendance' %}" class="nav-item">
                    <div class="nav-icon">
                        <i class="fas fa-clipboard-check"></i>
                        <div class="nav-glow"></div>
                    </div>
                    <span>ATTENDANCE</span>
                    <div class="nav-indicator"></div>
                </a>
                <a href="#" class="nav-item" data-bs-toggle="modal" data-bs-target="#profileModal">
                    <div class="nav-icon">
                        <i class="fas fa-user-cog"></i>
                        <div class="nav-glow"></div>
                    </div>
                    <span>PROFILE</span>
                    <div class="nav-indicator"></div>
                </a>
                
                <!-- Profile Edit Modal -->
                    <div class="modal" id="profileModal">
                        <div class="modal-dialog modal-lg">
                            <div class="modal-content cyber-modal">
                                <form method="post" enctype="multipart/form-data" action="{% url 'profile_edit' %}">
                                    {% csrf_token %}
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="profileModalLabel">EDIT PROFILE</h5>
                                        <button type="button" class="btn-close" onclick="closeModal(this.closest('.modal'))">&times;</button>
                                    </div>

                                    <div class="modal-body">
                                        <!-- User update form -->
                                        <div class="form-section">
                                            <h6 class="form-section-title">
                                                <i class="fas fa-user"></i>
                                                PERSONAL INFO
                                            </h6>
                                            {{ user_form.as_p }}
                                        </div>

                                        <!-- Lecturer-specific form -->
                                        <div class="form-section">
                                            <h6 class="form-section-title">
                                                <i class="fas fa-chalkboard-teacher"></i>
                                                LECTURER PROFILE
                                            </h6>
                                            {{ lecturer_form.as_p }}
                                        </div>
                                    </div>

                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" onclick="closeModal(this.closest('.modal'))">CANCEL</button>
                                        <button type="submit" class="btn btn-primary cyber-btn">SAVE CHANGES</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                
                <div class="nav-divider"></div>
                <a href="#" class="nav-item">
                    <div class="nav-icon">
                        <i class="fas fa-question-circle"></i>
                        <div class="nav-glow"></div>
                    </div>
                    <span>HELP & SUPPORT</span>
                    <div class="nav-indicator"></div>
                </a>
            </nav>

            
            <!-- Quick Stats Sidebar -->
            <div class="sidebar-stats">
                <div class="stat-card mini cyber-stat">
                    <div class="stat-icon">
                        <i class="fas fa-users"></i>
                        <div class="icon-glow"></div>
                    </div>
                    <div class="stat-info">
                        <span class="stat-value">{{ total_students }}</span>
                        <span class="stat-label">TOTAL STUDENTS</span>
                    </div>
                </div>
                <div class="stat-card mini cyber-stat">
                    <div class="stat-icon">
                        <i class="fas fa-book"></i>
                        <div class="icon-glow"></div>
                    </div>
                    <div class="stat-info">
                        <span class="stat-value">{{ teaching_units }}</span>
                        <span class="stat-label">TEACHING UNITS</span>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="main-content">
            <!-- Welcome Section -->
            <section class="welcome-section">
                <div class="welcome-card cyber-card">
                    <div class="card-glow"></div>
                    <div class="welcome-content">
                        <h2>WELCOME BACK, <span class="cyber-text">{{ user.first_name|default:"PROFESSOR" }}</span>! ðŸ‘‹</h2>
                        <p class="welcome-text">READY TO MANAGE YOUR CLASSES AND TRACK ATTENDANCE EFFICIENTLY.</p>
                        <div class="quick-actions">
                            <button class="btn-primary cyber-btn" onclick="location.href='{% url 'lecturer_portal' %}?tab=classes'">
                                <i class="fas fa-plus"></i>SCHEDULE NEW CLASS
                            </button>
                            <button class="btn-secondary cyber-btn" onclick="location.href='{% url 'lecturer_attendance' %}'">
                                <i class="fas fa-clipboard-list"></i>VIEW ATTENDANCE
                            </button>
                        </div>
                    </div>
                    <div class="welcome-graphic">
                        <div class="cyber-graphic">
                            <i class="fas fa-chart-line"></i>
                            <div class="graphic-glow"></div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Statistics Overview -->
            <section class="stats-section">
                <h3 class="section-title cyber-title">OVERVIEW</h3>
                <div class="stats-grid">
                    <div class="stat-card large cyber-stat">
                        <div class="stat-icon primary">
                            <i class="fas fa-calendar-day"></i>
                            <div class="icon-glow"></div>
                        </div>
                        <div class="stat-info">
                            <span class="stat-value">{{ todays_classes.count }}</span>
                            <span class="stat-label">TODAY'S CLASSES</span>
                            <span class="stat-trend positive">
                                <i class="fas fa-arrow-up"></i> ON SCHEDULE
                            </span>
                        </div>
                    </div>
                    
                    <div class="stat-card large cyber-stat">
                        <div class="stat-icon success">
                            <i class="fas fa-user-check"></i>
                            <div class="icon-glow"></div>
                        </div>
                        <div class="stat-info">
                            <span class="stat-value">{% widthratio present_students total_students 100 %}%</span>
                            <span class="stat-label">AVERAGE ATTENDANCE</span>
                            <span class="stat-trend positive">
                                <i class="fas fa-chart-line"></i> GOOD ENGAGEMENT
                            </span>
                        </div>
                    </div>
                    
                    <div class="stat-card large cyber-stat">
                        <div class="stat-icon warning">
                            <i class="fas fa-clock"></i>
                            <div class="icon-glow"></div>
                        </div>
                        <div class="stat-info">
                            <span class="stat-value">{{ upcoming_classes.count }}</span>
                            <span class="stat-label">UPCOMING CLASSES</span>
                            <span class="stat-trend neutral">
                                <i class="fas fa-calendar"></i> NEXT 7 DAYS
                            </span>
                        </div>
                    </div>
                    
                    <div class="stat-card large cyber-stat">
                        <div class="stat-icon info">
                            <i class="fas fa-chart-bar"></i>
                            <div class="icon-glow"></div>
                        </div>
                        <div class="stat-info">
                            <span class="stat-value">{{ teaching_units }}</span>
                            <span class="stat-label">ACTIVE UNITS</span>
                            <span class="stat-trend positive">
                                <i class="fas fa-book"></i> THIS SEMESTER
                            </span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Today's Classes & Quick Actions -->
            <section class="content-grid">
                <!-- Today's Classes -->
                <div class="content-card cyber-card">
                    <div class="card-glow"></div>
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-calendar-day"></i>
                            TODAY'S CLASSES
                        </h3>
                        <span class="card-badge cyber-badge">{{ todays_classes.count }}</span>
                    </div>
                    <div class="card-content">
                        {% if todays_classes %}
                            <div class="classes-list">
                                {% for class in todays_classes %}
                                <div class="class-item cyber-item {% if class.is_ongoing %}ongoing{% endif %}">
                                    <div class="class-info">
                                        <h4 class="class-name">{{ class.semester_unit.unit.name }}</h4>
                                        <div class="class-details">
                                            <span class="class-time">
                                                <i class="fas fa-clock"></i>
                                                {{ class.start_time|time:"H:i" }} - {{ class.end_time|time:"H:i" }}
                                            </span>
                                            <span class="class-venue">
                                                <i class="fas fa-map-marker-alt"></i>
                                                {{ class.venue }}
                                            </span>
                                        </div>
                                        {% if class.is_ongoing %}
                                        <span class="class-status ongoing cyber-status">ONGOING</span>
                                        {% endif %}
                                    </div>
                                    <div class="class-actions">
                                        {% if class.is_ongoing %}
                                        <button class="btn-sm btn-success cyber-btn" onclick="generateQRCode('{{ class.id }}')">
                                            <i class="fas fa-qrcode"></i> GENERATE QR
                                        </button>
                                        {% endif %}
                                        <button class="btn-sm btn-outline cyber-btn" onclick="location.href='{% url 'lecturer_attendance' %}?class_id={{ class.id }}'">
                                            <i class="fas fa-clipboard-check"></i> ATTENDANCE
                                        </button>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        {% else %}
                            <div class="empty-state">
                                <i class="fas fa-calendar-times"></i>
                                <p>NO CLASSES SCHEDULED FOR TODAY</p>
                                <button class="btn-primary cyber-btn" onclick="location.href='{% url 'lecturer_portal' %}?tab=classes'">
                                    SCHEDULE A CLASS
                                </button>
                            </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="content-card cyber-card">
                    <div class="card-glow"></div>
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-bolt"></i>
                            QUICK ACTIONS
                        </h3>
                    </div>
                    <div class="card-content">
                        <div class="quick-actions-grid">
                            <button class="quick-action-btn cyber-action" onclick="location.href='{% url 'lecturer_portal' %}?tab=classes'">
                                <div class="action-icon">
                                    <i class="fas fa-plus-circle"></i>
                                    <div class="action-glow"></div>
                                </div>
                                <span>SCHEDULE CLASS</span>
                            </button>
                            
                            <button class="quick-action-btn cyber-action" onclick="location.href='{% url 'lecturer_attendance' %}'">
                                <div class="action-icon">
                                    <i class="fas fa-clipboard-check"></i>
                                    <div class="action-glow"></div>
                                </div>
                                <span>MARK ATTENDANCE</span>
                            </button>
                            
                            <button class="quick-action-btn cyber-action" onclick="location.href='{% url 'lecturer_portal' %}'">
                                <div class="action-icon">
                                    <i class="fas fa-book"></i>
                                    <div class="action-glow"></div>
                                </div>
                                <span>VIEW UNITS</span>
                            </button>
                            
                            <button class="quick-action-btn cyber-action" onclick="location.href='{% url 'lecturer_attendance' %}?tab=reports'">
                                <div class="action-icon">
                                    <i class="fas fa-chart-bar"></i>
                                    <div class="action-glow"></div>
                                </div>
                                <span>GENERATE REPORT</span>
                            </button>
                            
                            <button class="quick-action-btn cyber-action" onclick="showTutorial()">
                                <div class="action-icon">
                                    <i class="fas fa-question-circle"></i>
                                    <div class="action-glow"></div>
                                </div>
                                <span>GET HELP</span>
                            </button>
                            
                            <button class="quick-action-btn cyber-action" onclick="location.href='{% url 'profile_edit' %}'">
                                <div class="action-icon">
                                    <i class="fas fa-cog"></i>
                                    <div class="action-glow"></div>
                                </div>
                                <span>SETTINGS</span>
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Upcoming Classes & Attendance Chart -->
            <section class="content-grid">
                <!-- Upcoming Classes -->
                <div class="content-card cyber-card">
                    <div class="card-glow"></div>
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-calendar-week"></i>
                            UPCOMING CLASSES (NEXT 7 DAYS)
                        </h3>
                    </div>
                    <div class="card-content">
                        {% if upcoming_classes %}
                            <div class="upcoming-classes">
                                {% for class in upcoming_classes %}
                                <div class="upcoming-class-item cyber-item">
                                    <div class="class-date">
                                        <span class="date-day">{{ class.schedule_date|date:"d" }}</span>
                                        <span class="date-month">{{ class.schedule_date|date:"M" }}</span>
                                    </div>
                                    <div class="class-details">
                                        <h4 class="class-name">{{ class.semester_unit.unit.name }}</h4>
                                        <div class="class-meta">
                                            <span class="class-time">{{ class.start_time|time:"H:i" }} - {{ class.end_time|time:"H:i" }}</span>
                                            <span class="class-venue">{{ class.venue }}</span>
                                        </div>
                                    </div>
                                    <div class="class-actions">
                                        <button class="btn-sm btn-outline cyber-btn" onclick="location.href='{% url 'lecturer_portal' %}?class_id={{ class.id }}'">
                                            DETAILS
                                        </button>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        {% else %}
                            <div class="empty-state">
                                <i class="fas fa-calendar-plus"></i>
                                <p>NO UPCOMING CLASSES IN THE NEXT 7 DAYS</p>
                            </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Attendance Overview Chart -->
                <div class="content-card cyber-card">
                    <div class="card-glow"></div>
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-chart-pie"></i>
                            ATTENDANCE OVERVIEW
                        </h3>
                    </div>
                    <div class="card-content">
                        <div class="chart-container">
                            <canvas id="attendanceChart"></canvas>
                        </div>
                        <div class="chart-legend">
                            <div class="legend-item">
                                <span class="legend-color present"></span>
                                <span>PRESENT (75%)</span>
                            </div>
                            <div class="legend-item">
                                <span class="legend-color late"></span>
                                <span>LATE (15%)</span>
                            </div>
                            <div class="legend-item">
                                <span class="legend-color absent"></span>
                                <span>ABSENT (10%)</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- System Guide & Notifications -->
            <section class="content-grid">
                <!-- Getting Started Guide -->
                <div class="content-card cyber-card">
                    <div class="card-glow"></div>
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-graduation-cap"></i>
                            GETTING STARTED GUIDE
                        </h3>
                    </div>
                    <div class="card-content">
                        <div class="guide-steps">
                            <div class="guide-step completed cyber-step">
                                <div class="step-number">1</div>
                                <div class="step-content">
                                    <h4>SET UP YOUR PROFILE</h4>
                                    <p>COMPLETE YOUR LECTURER PROFILE WITH CONTACT INFORMATION</p>
                                </div>
                                <i class="fas fa-check-circle"></i>
                            </div>
                            
                            <div class="guide-step completed cyber-step">
                                <div class="step-number">2</div>
                                <div class="step-content">
                                    <h4>REVIEW ASSIGNED UNITS</h4>
                                    <p>CHECK THE UNITS YOU'RE TEACHING THIS SEMESTER</p>
                                </div>
                                <i class="fas fa-check-circle"></i>
                            </div>
                            
                            <div class="guide-step active cyber-step">
                                <div class="step-number">3</div>
                                <div class="step-content">
                                    <h4>SCHEDULE YOUR CLASSES</h4>
                                    <p>CREATE CLASS SCHEDULES WITH LOCATIONS AND TIMES</p>
                                    <button class="btn-sm btn-primary cyber-btn" onclick="location.href='{% url 'lecturer_portal' %}?tab=classes'">
                                        SCHEDULE NOW
                                    </button>
                                </div>
                            </div>
                            
                            <div class="guide-step cyber-step">
                                <div class="step-number">4</div>
                                <div class="step-content">
                                    <h4>TRACK ATTENDANCE</h4>
                                    <p>USE QR CODES OR MANUAL ENTRY TO MARK STUDENT ATTENDANCE</p>
                                </div>
                            </div>
                            
                            <div class="guide-step cyber-step">
                                <div class="step-number">5</div>
                                <div class="step-content">
                                    <h4>GENERATE REPORTS</h4>
                                    <p>CREATE ATTENDANCE REPORTS FOR ADMINISTRATION</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Activity & Notifications -->
                <div class="content-card cyber-card">
                    <div class="card-glow"></div>
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-bell"></i>
                            RECENT ACTIVITY
                        </h3>
                    </div>
                    <div class="card-content">
                        <div class="activity-feed">
                            <div class="activity-item cyber-activity">
                                <div class="activity-icon success">
                                    <i class="fas fa-qrcode"></i>
                                    <div class="activity-glow"></div>
                                </div>
                                <div class="activity-content">
                                    <p>QR CODE GENERATED FOR DATABASE SYSTEMS CLASS</p>
                                    <span class="activity-time">2 HOURS AGO</span>
                                </div>
                            </div>
                            
                            <div class="activity-item cyber-activity">
                                <div class="activity-icon info">
                                    <i class="fas fa-clipboard-check"></i>
                                    <div class="activity-glow"></div>
                                </div>
                                <div class="activity-content">
                                    <p>ATTENDANCE MARKED FOR 45 STUDENTS IN WEB DEVELOPMENT</p>
                                    <span class="activity-time">YESTERDAY, 10:30 AM</span>
                                </div>
                            </div>
                            
                            <div class="activity-item cyber-activity">
                                <div class="activity-icon warning">
                                    <i class="fas fa-exclamation-triangle"></i>
                                    <div class="activity-glow"></div>
                                </div>
                                <div class="activity-content">
                                    <p>LOW ATTENDANCE ALERT: NETWORK SECURITY (65%)</p>
                                    <span class="activity-time">2 DAYS AGO</span>
                                </div>
                            </div>
                            
                            <div class="activity-item cyber-activity">
                                <div class="activity-icon primary">
                                    <i class="fas fa-calendar-plus"></i>
                                    <div class="activity-glow"></div>
                                </div>
                                <div class="activity-content">
                                    <p>NEW CLASS SCHEDULED: ADVANCED PROGRAMMING</p>
                                    <span class="activity-time">3 DAYS AGO</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Tutorial Modal -->
    <div id="tutorialModal" class="modal cyber-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>WELCOME TO ATTENDIFY - LECTURER GUIDE</h3>
                <button class="modal-close" onclick="closeTutorial()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="tutorial-steps">
                    <div class="tutorial-step active">
                        <h4>ðŸ“… SCHEDULING CLASSES</h4>
                        <p>GO TO TEACHING PORTAL â†’ CLASSES TAB TO SCHEDULE NEW CLASSES WITH LOCATIONS AND TIMES.</p>
                    </div>
                    <div class="tutorial-step">
                        <h4>ðŸ“± QR CODE ATTENDANCE</h4>
                        <p>GENERATE QR CODES DURING CLASS TIME FOR STUDENTS TO SCAN AND MARK ATTENDANCE AUTOMATICALLY.</p>
                    </div>
                    <div class="tutorial-step">
                        <h4>ðŸ‘¥ MANUAL ATTENDANCE</h4>
                        <p>USE THE ATTENDANCE SECTION TO MANUALLY MARK STUDENT ATTENDANCE IF NEEDED.</p>
                    </div>
                    <div class="tutorial-step">
                        <h4>ðŸ“Š REPORTS & ANALYTICS</h4>
                        <p>GENERATE DETAILED ATTENDANCE REPORTS FOR ADMINISTRATION AND ANALYSIS.</p>
                    </div>
                </div>
                <div class="tutorial-navigation">
                    <button class="btn-outline cyber-btn" onclick="prevTutorialStep()">PREVIOUS</button>
                    <button class="btn-primary cyber-btn" onclick="nextTutorialStep()">NEXT</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Spinner -->
    <div id="loadingSpinner" class="loading-spinner">
        <div class="cyber-spinner"></div>
    </div>

    <!-- External JavaScript -->
    <script src="{% static 'js/lecturer.js' %}"></script>
</body>
</html>